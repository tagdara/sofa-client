(this["webpackJsonpsofa-client"]=this["webpackJsonpsofa-client"]||[]).push([[115],{156:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return h}));var n=a(6),o=a(0),i=a.n(o),r=a(38),c=a(401),l=a(396),u=a.n(l),s=a(331),m=a.n(s),d=a(395),p=a.n(d),f=a(283),b=a(85),g=Object(r.a)({bigcamDialog:{backgroundColor:"#222",paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)",minWidth:"320px",boxSizing:"border-box"},root:{backgroundColor:"#111"},paper:{backgroundColor:"#111",boxShadow:"none",overflow:"hidden"},bigcamPaper:{margin:"auto 4px",maxHeight:"100%",display:"flex"},bigcam:{width:"100%",height:"auto !important",maxWidth:"100%",maxHeight:"100%",background:"#222",opacity:"1.0",margin:"auto auto",padding:0,borderRadius:4},bigcamRotated:{position:"absolute",top:0,left:0,height:"100vw",maxWidth:"initial",padding:0,margin:"auto auto",marginTop:"calc((100vh - 100vw) / 2.5)",marginLeft:"calc((100vw * -1) /2.5) !important",borderRadius:4},rotatebutton:{zIndex:2e3,position:"absolute",top:16,right:72},ratebutton:{zIndex:2e3,position:"absolute",top:16,right:190},closebutton:{zIndex:2e3,position:"absolute",top:16,right:16}}),v=window.Hls;function h(e){var t=g(),a=Object(o.useState)(0),r=Object(n.a)(a,2),l=r[0],s=r[1],d=Object(o.useState)(""),h=Object(n.a)(d,2),C=h[0],w=h[1],E=Object(o.useRef)(null);function y(){document.querySelector("meta[name=viewport]").setAttribute("content","viewport-fit=cover, width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes")}function S(t){document.querySelector("meta[name=viewport]").setAttribute("content","viewport-fit=cover, width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"),e.close()}return Object(o.useEffect)((function(){y()}),[]),Object(o.useEffect)((function(){e.directive(e.camera.endpointId,"CameraStreamController","InitializeCameraStreams",{cameraStreams:[{protocol:"HLS",resolution:{width:640,height:480},authorizationType:"BASIC",videoCodec:"H264",audioCodec:"AAC"}]}).then((function(e){return w(e.payload.cameraStreams[0].uri)}))}),[e.camera]),Object(o.useEffect)((function(){if(console.log("uri update",C),y(),e.live&&window.Hls.isSupported()){var t=new v;t.loadSource(C),t.attachMedia(E.current),t.on(v.Events.MANIFEST_PARSED,(function(){E.current.play()}))}}),[C,e.live]),i.a.createElement(c.a,{fullScreen:!0,open:e.show,onClose:function(){return S()},className:t.bigcamDialog,PaperProps:{classes:{root:t.paper}}},!e.live&&i.a.createElement(b.a,{size:"medium","aria-label":"Rate",className:t.ratebutton,onClick:function(){return e.changeInterval()}},i.a.createElement(p.a,null),e.refreshInterval/1e3),i.a.createElement(b.a,{size:"medium",color:"primary","aria-label":"Close",className:t.closebutton,onClick:function(){return S()}},i.a.createElement(m.a,null)),i.a.createElement(b.a,{size:"medium","aria-label":"Rotate",className:t.rotatebutton,onClick:function(){return s(90!==l?90:0),void console.log("set rotate to ",l)}},i.a.createElement(u.a,null)),i.a.createElement(f.a,{className:t.bigcamPaper},e.live?i.a.createElement("video",{controls:!0,muted:!0,autoPlay:!0,playsInline:!0,id:"video",className:l>0?t.bigcamRotated:t.bigcam,style:{transform:"rotate(".concat(l,"deg)")},ref:E},i.a.createElement("source",{src:C,type:"application/x-mpegURL"})):i.a.createElement("img",{alt:e.camera.friendlyName,className:l>0?t.bigcamRotated:t.bigcam,style:{transform:"rotate(".concat(l,"deg)")},src:e.src})))}},165:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return C}));var n=a(6),o=a(0),i=a.n(o),r=a(19),c=a(38),l=a(361),u=a(333),s=a(371),m=a.n(s),d=a(372),p=a.n(d),f=a(348),b=a.n(f),g=a(156),v=a(26),h=Object(c.a)({nextbutton:{position:"absolute",top:"40%",right:8},prevbutton:{position:"absolute",top:"40%",left:8},gridbutton:{position:"absolute",left:8,bottom:8},newgridbutton:{position:"absolute",right:8,bottom:8},im:{width:"100%",height:"auto",borderRadius:4,display:"flex"},hiddenimage:{height:0,display:"none"},hidden:{borderRadius:4,position:"relative",width:"100%",paddingTop:"56.25%"},spinner:{position:"absolute",margin:"auto",top:0,left:0,right:0,bottom:0}});function C(e){var t=h(),a=Object(o.useContext)(r.LayoutContext),c=a.isMobile,s=a.applyLayoutCard,d=[1e3,500,5e3,3e3],f=Object(o.useState)(!1),C=Object(n.a)(f,2),w=C[0],E=C[1],y=Object(o.useState)(!1),S=Object(n.a)(y,2),j=S[0],O=S[1],x=Object(o.useState)(3e3),I=Object(n.a)(x,2),N=I[0],k=I[1],R=Object(o.useState)(""),z=Object(n.a)(R,2),A=z[0],H=z[1],L=Object(o.useState)(""),B=Object(n.a)(L,2),D=B[0],P=B[1],T=Object(o.useState)(!1),M=Object(n.a)(T,2),F=M[0],U=M[1];return function(e,t){var a=Object(o.useRef)();Object(o.useEffect)((function(){a.current=e}),[e]),Object(o.useEffect)((function(){if(null!==t){var e=setInterval((function(){a.current()}),t);return function(){return clearInterval(e)}}}),[t])}((function(){A&&P(A+"?time="+Date.now())}),N),Object(o.useEffect)((function(){e.camera&&F!==e.camera.endpointId&&(U(e.camera.endpointId),e.directive(e.camera.endpointId,"CameraStreamController","InitializeCameraStreams",{cameraStreams:[{protocol:"HLS",resolution:{width:640,height:480},authorizationType:"BASIC",videoCodec:"H264",audioCodec:"AAC"}]}).then((function(e){return P((t=e).payload.imageUri+"?time="+Date.now()),void H(t.payload.imageUri);var t})))}),[e.camera,F]),i.a.createElement(v.default,{wide:e.wide,nopad:!0,thinmargin:c},A&&i.a.createElement("img",{className:w?t.im:t.hiddenimage,src:D,onLoad:function(){w||E(!0)},onClick:function(){O(!0)},alt:e.camera.friendlyName+" Security Camera"}),w?i.a.createElement(i.a.Fragment,null,e.prevCamera&&i.a.createElement(u.a,{color:"primary",className:t.prevbutton,onClick:function(){return e.prevCamera()}},i.a.createElement(m.a,null)),e.nextCamera&&i.a.createElement(u.a,{color:"primary",className:t.nextbutton,onClick:function(){return e.nextCamera()}},i.a.createElement(p.a,null)),e.selectButtons&&i.a.createElement(u.a,{color:"primary",className:t.newgridbutton,onClick:function(){return s("CameraLayout")}},i.a.createElement(b.a,null))):i.a.createElement("div",{className:t.hidden},i.a.createElement(l.a,{className:t.spinner,size:50})),j&&i.a.createElement(g.default,{directive:e.directive,live:!0,camera:e.camera,name:e.name,refreshInterval:N,changeInterval:function(){k(d.shift()),d.push(N)},show:j,close:function(){O(!1)},src:A}))}},229:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return l}));var n=a(6),o=a(0),i=a.n(o),r=a(56),c=a(165);function l(e){var t=Object(o.useContext)(r.DataContext),a=t.deviceStatesByCategory,l=t.directive,u=a(["CAMERA"]),s=Object(o.useState)(void 0),m=Object(n.a)(s,2),d=m[0],p=m[1];function f(){if(void 0===d)return u[0]?(p(u[0].endpointId),u[0]):void 0;for(var e=0;e<u.length;e++)if(d===u[e].endpointId)return u[e];return p(u[0].endpointId),u[0]}return i.a.createElement(i.a.Fragment,null,void 0!==f()?i.a.createElement(c.default,{wide:e.wide,camera:f(),selectButtons:!0,key:d,directive:l,name:f().friendlyName,nextCamera:function(){for(var e=0,t=0;t<u.length;t++)if(d===u[t].endpointId){e=t;break}var a=e+1;a>u.length-1&&(a=0),a<0&&(a=u.length-1),p(u[a].endpointId)},prevCamera:function(){for(var e=0,t=0;t<u.length;t++)if(d===u[t].endpointId){e=t;break}var a=e-1;a>u.length-1&&(a=0),a<0&&(a=u.length-1),p(u[a].endpointId)}}):null)}}}]);
//# sourceMappingURL=115.0622727e.chunk.js.map